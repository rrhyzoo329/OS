# Chapter04CPU스케줄링 [3.다중큐] 

<br>

### 다중 큐

1.  다중 큐란
   - 프로세스의 중요도는 PCB에 표시된다. CPU 스케줄러는 모든 PCB를 뒤져서 가장 높은 우선순위의 프로세스에 CPU를 할당한다. 하지만 매번 모든 PCB를 찾는다는 것은 비효율적인 일이다.

2.  준비 상태의 다중 큐

   ![큐](https://user-images.githubusercontent.com/93310395/181177232-a58ac04d-ad9a-4da4-a36d-7839dcf70ef7.png)

   - 준비 상태의 큐에 삽입 시 자신의 우선순위에 해당하는 큐의 꼬리에 삽입된다.
   - 준비 큐를 몇개로 나눌지, 여러개의 프로세스 중 어떤 프로세스에 cpu를 할당할지는 스케줄링 알고리즘에 따라 달라진다. (고정과 변동 방식 있다)
   - 프로세스의 우선순위를 배정하는 방식에는 고정 우선순위와 변동 우선순위가 있다.
      - 고정 우선순위 방식 : 초기에 부여 -> 중간에 안바뀜, 구현 쉬움, 시스템 변화에 대응 어려움 -> 작업효율 떨어짐
      - 변동 우선순위 방식 : 우선순위가 프로세스 작업 중간에 변함(기준: 얼마나 오래 기다렸는가), 구현 어려움, 시스템 효율성 증가

   중요한 자원을 점유하고 있으며 우선순위가 낮은 P1 이라는 프로세스가 있다고 가정하면, 해당 자원을 사용하고자 하는 다른 우선순위가 높은 프로세스들은 P1이 선점하고 있는 자원을 사용하기 위해서 기다려야하는 상황이 발생할 수 있다. 이 때 변동 우선순위 방식을 사용하여 P1의 우선순위를 높이면 다른 프로세스의 작업도 원활하게 진행될 수 있다.
      <b> 프로세스의 우선순위가 낮은 놈을 높게 바꾸는 것을 반전 우선순위라고 함 <b> 

3.  대기 상태의 다중 큐

     ![큐2](https://user-images.githubusercontent.com/93310395/181177468-4c16fa3c-10ab-4d10-9576-9896e357e938.png) 

   - 프로세스를 효율적으로 관리하기 위해 같은 입출력을 요구한 프로세스끼리 모아 큐를 여러 개 두어 관리한다.
   - 준비 상태에서는 우선순위에 따라 다중 큐를 운영하고, 대기 상태에서는 같은 입출력을 요구한 프로세스들을 모아 다중 큐를 운영한다.
   - 시스템내의 입출력 장치들이 워낙 많기 때문에 대기 상태의 프로세스를 한공간에 모아놓으면 관리하기 좋지 않으므로 여기서는 같은 입출력을 요구한 프로세스끼리 동일한 큐에 모아 놓으면 효율성이 높아진다.

   - 준비 상태의 다중 큐와 대기 상태의 다중 큐 차이
      - 준비 큐는 한 번에 하나의 프로세스를 꺼내어 CPU를 할당하는 반면, 대기 큐는 여러 개의 프로세스 제어 블록을 동시에 꺼내어 준비 상태로 옮긴다. 이렇게 동시에 끝나는 인터럽트를 처리하기 위해 인터럽트 벡터라는 자료 구조를 사용한다. 인터럽트 벡터에는 동시에 완료된 입출력 정보와 처리 방법이 담겨 있는데, 이 정보에 따라 완료된 프로세스 제어 블록은 모두 준비 상태로 이동한다.
   
   - 전체적인 프로세스 실행 단계는 아래 그림으로 표현할 수 있음
   
   ![ㅋㅍ](https://user-images.githubusercontent.com/93310395/181180322-9f1bd9b6-f880-44d9-8713-be07510db62b.png)



- <B>참고<B>  
   - 인터럽트 벡터는 인터럽트의 집합으로 인터럽트와 인터럽트 핸들러를 일대일로 연결한 자료 구조이다. 인터럽트가 발생하면 인터럽트 벡터의 번호가 0 에서 1로 바뀐다. 이 때 해당 인터럽트가 발생하면 어떤 일을 처리할 것인지가 함수에 정의되어 있는데 이를 인터럽트 핸들러 라고 한다.

   - 인터럽트가 발생하면 현재 실행 중인 프로세스는 일시 정지 상태가 되며, 재시작하기 위해 현재 프로세스 관련 정보를 저장한다.
   인터럽트 컨트롤러가 실행되어 인터럽트의 처리 순서를 결정한다. 이 때 여러 개의 인터럽트가 발생했다면 우선순위를 고려하여 중요한 인터럽트부터 처리한다.
   처리할 인터럽트가 결정되면 인터럽트 벡터에 등록된 인터럽트 핸들러가 실행된다.
   인터럽트 벡터에 연결된 핸들러가 인터럽트 처리를 마치면 일시 정지된 프로세스가 다시 실행되거나 종료된다. 발생한 인터럽트가 일시 정지된 프로세스일 경우 추후 재시작 되며, 오류 같은 경우 종료된다.
``` 